<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/alexthemathnerd/Code/Capstone/code/CapstoneTest/BackendTests/Model/TestUserManager/TestRegisterUser.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using CapstoneBackend.DAL;
using CapstoneBackend.Model;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Moq;
using System;

namespace CapstoneTest.BackendTests.Model.TestUserManager
{

    [TestClass]
    public class TestRegisterUser
    {
        [TestMethod]
        public void Register_WithValidInput_Succeeds()
        {
            string username = &quot;TestUsername&quot;;
            string password = &quot;TestPassword&quot;;
            string fname = &quot;FirstName&quot;;
            string lname = &quot;LastName&quot;;

            User? fakeExistingUser = null;
            User fakeCreatedUser = new() { Id = 1 };
            var mockUserDAL = new Mock&lt;UserDal&gt;();
            mockUserDAL.Setup(db =&gt; db.GetUserByUsername(username)).Returns(fakeExistingUser);
            mockUserDAL.Setup(db =&gt; db.CreateUser(username, password, fname, lname)).Returns(fakeCreatedUser.Id);

            UserManager userManager = new(mockUserDAL.Object);

            var resultResponse = userManager.RegisterUser(username, password, fname, lname);

            Assert.AreEqual(200U, resultResponse.StatusCode);
            Assert.AreEqual(1, resultResponse.Data);
        }

        [TestMethod]
        public void Register_WithDuplicateUsername_Fails()
        {
            string username = &quot;TestUsername&quot;;
            string password = &quot;TestPassword&quot;;
            string fname = &quot;FirstName&quot;;
            string lname = &quot;LastName&quot;;

            int? dbResult = null;
            User fakeExistingUser = new() { Id = 1 };
            var mockUserDAL = new Mock&lt;UserDal&gt;();
            mockUserDAL.Setup(db =&gt; db.GetUserByUsername(username)).Returns(fakeExistingUser);
            mockUserDAL.Setup(db =&gt; db.CreateUser(username, password, fname, lname)).Returns(dbResult);

            UserManager userManager = new(mockUserDAL.Object);

            var resultResponse = userManager.RegisterUser(username, password, fname, lname);

            Assert.AreEqual(400U, resultResponse.StatusCode);
        }

        [TestMethod]
        public void Register_InternalServerErrorConfiguration_Fails()
        {
            string username = &quot;TestUsername&quot;;
            string password = &quot;TestPassword&quot;;
            string fname = &quot;FirstName&quot;;
            string lname = &quot;LastName&quot;;

            int? dbResult = null;
            User? fakeExistingUser = null;
            var mockUserDAL = new Mock&lt;UserDal&gt;();
            mockUserDAL.Setup(db =&gt; db.GetUserByUsername(username)).Returns(fakeExistingUser);
            mockUserDAL.Setup(db =&gt; db.CreateUser(username, password, fname, lname)).Returns(dbResult);

            UserManager userManager = new(mockUserDAL.Object);

            var resultResponse = userManager.RegisterUser(username, password, fname, lname);

            Assert.AreEqual(500U, resultResponse.StatusCode);
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[15,9,15,10,1],[16,13,16,46,1],[17,13,17,46,1],[18,13,18,40,1],[19,13,19,39,1],[21,13,21,43,1],[22,13,22,53,1],[23,13,23,51,1],[24,13,24,95,1],[25,13,25,114,1],[27,13,27,63,1],[29,13,29,93,1],[31,13,31,62,1],[32,13,32,53,1],[33,9,33,10,1],[37,9,37,10,1],[38,13,38,46,1],[39,13,39,46,1],[40,13,40,40,1],[41,13,41,39,1],[43,13,43,34,1],[44,13,44,54,1],[45,13,45,51,1],[46,13,46,95,1],[47,13,47,104,1],[49,13,49,63,1],[51,13,51,93,1],[53,13,53,62,1],[54,9,54,10,1],[58,9,58,10,1],[59,13,59,46,1],[60,13,60,46,1],[61,13,61,40,1],[62,13,62,39,1],[64,13,64,34,1],[65,13,65,43,1],[66,13,66,51,1],[67,13,67,95,1],[68,13,68,104,1],[70,13,70,63,1],[72,13,72,93,1],[74,13,74,62,1],[75,9,75,10,1]]);
    </script>
  </body>
</html>