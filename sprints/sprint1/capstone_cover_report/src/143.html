<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/alexthemathnerd/Code/Capstone/code/CapstoneDesktop/ViewModels/TripOverviewPageViewModel.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using CapstoneBackend.Model;
using ReactiveUI;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Reactive;
using Avalonia.Data.Converters;
using CapstoneDesktop.Converters;

namespace CapstoneDesktop.ViewModels
{
    public class TripOverviewPageViewModel : ViewModelBase, IRoutableViewModel
    {
        
        private readonly WaypointManager _waypointManager;
        private DateTime? _selectedDate;

        public IScreen HostScreen { get; }
        public string UrlPathSegment { get; } = Guid.NewGuid().ToString().Substring(0, 5);

        public IValueConverter DateFormatter { get; set; } = new DateFormatter();
        
        public ReactiveCommand&lt;Unit, IRoutableViewModel&gt; LogoutCommand { get; }
        
        public ReactiveCommand&lt;Unit, Unit&gt; BackCommand { get; }
        public ReactiveCommand&lt;Unit, IRoutableViewModel&gt; CreateWaypointCommand { get; }
        public ObservableCollection&lt;WaypointViewModel&gt; WaypointViewModels { get; }
        
        public Trip Trip { get; }

        public DateTime? SelectedDate
        {
            get =&gt; this._selectedDate;
            set
            {
                this.RaiseAndSetIfChanged(ref this._selectedDate, value, nameof(SelectedDate));
                this.updateWaypoints();
            }
        }

        public TripOverviewPageViewModel(Trip trip, WaypointManager waypointManager, IScreen screen)
        {
            this.Trip = trip;
            this._waypointManager = waypointManager;
            this.HostScreen = screen;
            this.LogoutCommand = ReactiveCommand.CreateFromObservable(() =&gt; this.HostScreen.Router.Navigate.Execute(new LoginPageViewModel(this.HostScreen)));
            this.CreateWaypointCommand = ReactiveCommand.CreateFromObservable(() =&gt; this.HostScreen.Router.Navigate.Execute(new CreateWaypointPageViewModel(this.Trip, this.HostScreen)));
            this.BackCommand = ReactiveCommand.CreateFromObservable(() =&gt; this.HostScreen.Router.NavigateBack.Execute());
            this.WaypointViewModels = new ObservableCollection&lt;WaypointViewModel&gt;();
        }

        private void updateWaypoints()
        {
            this.WaypointViewModels.Clear();
            if (this.SelectedDate is not null)
            {
                var response = this._waypointManager.GetWaypointsOnDate(this.Trip.TripId, (DateTime)this.SelectedDate);
                foreach (var waypoint in response.Data ?? new List&lt;Waypoint&gt;())
                {
                    this.WaypointViewModels.Add(new WaypointViewModel(waypoint, this.HostScreen));
                }
            }
        }

        public TripOverviewPageViewModel(Trip trip, IScreen screen) : this(trip, new WaypointManager(), screen)
        {
        }

    }
}

    </pre>
    <script type="text/javascript">
      highlightRanges([[18,37,18,41,0],[19,40,19,44,0],[19,49,19,90,1],[21,48,21,52,0],[21,53,21,57,0],[21,62,21,81,1],[23,74,23,78,1],[25,58,25,62,1],[26,82,26,86,0],[27,77,27,81,0],[29,28,29,32,1],[33,20,33,38,0],[35,13,35,14,0],[36,17,36,96,0],[37,17,37,40,0],[38,13,38,14,0],[41,9,41,101,1],[42,9,42,10,1],[43,13,43,30,1],[44,13,44,53,1],[45,13,45,38,1],[46,13,46,77,1],[46,77,46,157,0],[46,157,46,159,1],[47,13,47,85,1],[47,85,47,185,0],[47,185,47,187,1],[48,13,48,75,1],[48,75,48,120,0],[48,120,48,122,1],[49,13,49,85,1],[50,9,50,10,1],[53,9,53,10,0],[54,13,54,45,0],[55,13,55,47,0],[56,13,56,14,0],[57,17,57,120,0],[58,17,58,24,0],[58,26,58,38,0],[58,39,58,41,0],[58,42,58,79,0],[59,17,59,18,0],[60,21,60,99,0],[61,17,61,18,0],[62,13,62,14,0],[63,9,63,10,0],[65,71,65,112,1],[66,9,66,10,1],[67,9,67,10,1]]);
    </script>
  </body>
</html>