<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/alexthemathnerd/Code/Capstone/code/CapstoneBackend/DAL/TripDAL.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using System.Collections.Generic;
using System.Data;
using CapstoneBackend.Model;
using MySql.Data.MySqlClient;

namespace CapstoneBackend.DAL
{
    /// &lt;summary&gt;
    /// The DAL for accessing trip information
    /// &lt;/summary&gt;
    public class TripDal
    {
        private readonly MySqlConnection _connection;

        /// &lt;summary&gt;
        /// Creates a TripDal
        /// &lt;/summary&gt;
        public TripDal() : this(new MySqlConnection(Connection.ConnectionString))
        {
        }

        /// &lt;summary&gt;
        /// Creates a TripDal using a specific connection.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;connection&quot;&gt;a MySQLConnection&lt;/param&gt;
        private TripDal(MySqlConnection connection)
        {
            _connection = connection;
        }
        
        /// &lt;summary&gt;
        /// Gets trips of the user with the given id.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;the user&#39;s id&lt;/param&gt;
        /// &lt;returns&gt;A list of trips of the user with the given id.&lt;/returns&gt;
        public virtual IList&lt;Trip&gt; GetTripsByUserId(int userId)
        {
            this._connection.Open();
            const string query = &quot;uspGetTripsByUserId&quot;;
            using MySqlCommand cmd = new(query, _connection);
            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.Add(&quot;@userId&quot;, MySqlDbType.Int32).Value = userId;
            using var reader = cmd.ExecuteReaderAsync().Result;
            var idOrdinal = reader.GetOrdinal(&quot;id&quot;);
            var nameOrdinal = reader.GetOrdinal(&quot;name&quot;);
            var startDateOrdinal = reader.GetOrdinal(&quot;startDate&quot;);
            var endDateOrdinal = reader.GetOrdinal(&quot;endDate&quot;);

            IList&lt;Trip&gt; trips = new List&lt;Trip&gt;();
            
            if (reader.Read())
            {
                trips.Add(new Trip
                {
                    Id = reader.GetInt32(idOrdinal),
                    UserId = userId,
                    Name = reader.GetString(nameOrdinal),
                    StartDate = reader.GetDateTime(startDateOrdinal),
                    EndDate = reader.GetDateTime(endDateOrdinal)
                });
            }
              
            this._connection.Close();
            return trips;
        }
        
        /// &lt;summary&gt;
        /// Creates a Trip in the database
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;userId&quot;&gt;the userId&lt;/param&gt;
        /// &lt;param name=&quot;name&quot;&gt;the name of the trip&lt;/param&gt;
        /// &lt;param name=&quot;startDate&quot;&gt;the start date of the trip&lt;/param&gt;
        /// &lt;param name=&quot;endDate&quot;&gt;the end date of the trip&lt;/param&gt;
        /// &lt;returns&gt;the trip id of the created trip or null if it failed&lt;/returns&gt;
        public virtual int? CreateTrip(int userId, string name, DateTime startDate, DateTime endDate)
        {
            this._connection.Open();
            const string procedure = &quot;uspCreateTrip&quot;;
            using MySqlCommand cmd = new(procedure, _connection);
            cmd.CommandType = CommandType.StoredProcedure;

            cmd.Parameters.Add(&quot;@userId&quot;, MySqlDbType.Int32).Value = userId;
            cmd.Parameters.Add(&quot;@name&quot;, MySqlDbType.VarChar).Value = name;
            cmd.Parameters.Add(&quot;@startDate&quot;, MySqlDbType.Date).Value = startDate;
            cmd.Parameters.Add(&quot;@endDate&quot;, MySqlDbType.Date).Value = endDate;

            try
            {
                var tripId = cmd.ExecuteScalar();
                this._connection.Close();
                return Convert.ToInt32(tripId);
            }
            catch
            {
                this._connection.Close();
                return null;
            }
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[19,28,19,82,1],[20,9,20,10,1],[21,9,21,10,1],[27,9,27,52,1],[28,9,28,10,1],[29,13,29,38,1],[30,9,30,10,1],[38,9,38,10,0],[39,13,39,37,0],[41,13,41,62,0],[42,13,42,59,0],[43,13,43,77,0],[44,13,44,64,0],[45,13,45,53,0],[46,13,46,57,0],[47,13,47,67,0],[48,13,48,63,0],[50,13,50,50,0],[52,13,52,31,0],[53,13,53,14,0],[54,17,61,20,0],[62,13,62,14,0],[64,13,64,38,0],[65,13,65,26,0],[66,9,66,10,0],[77,9,77,10,0],[78,13,78,37,0],[80,13,80,66,0],[81,13,81,59,0],[83,13,83,77,0],[84,13,84,75,0],[85,13,85,82,0],[86,13,86,78,0],[89,13,89,14,0],[90,17,90,50,0],[91,17,91,42,0],[92,17,92,48,0],[94,13,94,18,0],[95,13,95,14,0],[96,17,96,42,0],[97,17,97,29,0],[99,9,99,10,0]]);
    </script>
  </body>
</html>