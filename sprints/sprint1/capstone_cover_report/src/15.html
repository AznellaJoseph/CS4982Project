<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>/home/alexthemathnerd/Code/Capstone/code/CapstoneBackend/Model/UserManager.cs</title>
    <script type="text/javascript" src="../js/dotcover.sourceview.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/dotcover.report.css" />
  </head>
  <body>
    <pre id="content" class="source-code">
using System;
using CapstoneBackend.DAL;
using CapstoneBackend.Utils;

namespace CapstoneBackend.Model
{
    /// &lt;summary&gt;
    ///     A wrapper class for the UserDal. Manages the collection of Users and informs of server errors.
    /// &lt;/summary&gt;
    public class UserManager
    {
        private readonly UserDal _dal;

        public UserManager() : this(new UserDal())
        {
        }

        public UserManager(UserDal dal)
        {
            _dal = dal;
        }


        /// &lt;summary&gt;
        ///     Gets a user by their credentials, i.e. username and password. If the user does not match any ones credentials then
        ///     an error is returned.
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;username&quot;&gt;the given username&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;the given password&lt;/param&gt;
        /// &lt;returns&gt;the data of the found user or an error&lt;/returns&gt;
        public virtual Response&lt;User&gt; GetUserByCredentials(string username, string password)
        {
            var user = _dal.GetUserByUsername(username);
            if (user is null)
                return new Response&lt;User&gt;
                {
                    StatusCode = 404,
                    ErrorMessage = &quot;Username is incorrect.&quot;
                };

            if (!PasswordHasher.ValidatePassword(password, user.Password))
                return new Response&lt;User&gt;
                {
                    StatusCode = 404,
                    ErrorMessage = &quot;Password is incorrect.&quot;
                };

            return new Response&lt;User&gt;
            {
                StatusCode = 200,
                Data = user
            };
        }

        /// &lt;summary&gt;Registers the user.&lt;/summary&gt;
        /// &lt;param name=&quot;username&quot;&gt;The username input.&lt;/param&gt;
        /// &lt;param name=&quot;password&quot;&gt;The password input.&lt;/param&gt;
        /// &lt;param name=&quot;fname&quot;&gt;The fname input.&lt;/param&gt;
        /// &lt;param name=&quot;lname&quot;&gt;The lname input.&lt;/param&gt;
        /// &lt;returns&gt;Response status 200 for success; 400 for bad username; 500 otherwise.&lt;/returns&gt;
        public virtual Response&lt;int&gt; RegisterUser(string username, string password, string fname, string lname)
        {
            var user = _dal.GetUserByUsername(username);
            if (user is not null)
                return new Response&lt;int&gt;
                {
                    StatusCode = 400,
                    ErrorMessage = &quot;Username is taken.&quot;
                };

            var userCreated = _dal.CreateUser(username, password, fname, lname);
            if (userCreated is not null)
                return new Response&lt;int&gt;
                {
                    StatusCode = 200,
                    Data = (int) userCreated
                };
            return new Response&lt;int&gt;
            {
                StatusCode = 500,
                ErrorMessage = &quot;Internal Server Error.&quot;
            };
        }
    }
}
    </pre>
    <script type="text/javascript">
      highlightRanges([[14,32,14,51,1],[15,9,15,10,1],[16,9,16,10,1],[18,9,18,40,1],[19,9,19,10,1],[20,13,20,24,1],[21,9,21,10,1],[32,9,32,10,1],[33,13,33,57,1],[34,13,34,30,1],[35,17,39,19,1],[41,13,41,75,1],[42,17,46,19,1],[48,13,52,15,1],[53,9,53,10,1],[62,9,62,10,1],[63,13,63,57,1],[64,13,64,34,1],[65,17,69,19,1],[71,13,71,81,1],[72,13,72,41,1],[73,17,77,19,1],[78,13,82,15,0],[83,9,83,10,1]]);
    </script>
  </body>
</html>